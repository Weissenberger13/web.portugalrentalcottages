@using BootstrapVillas.Models
@using BootstrapVillas.Content.Classes;
@using System.Globalization;
@using BootstrapVillas.Content.Classes.CurrencyConverter
@using BootstrapVillas.HTMLHelper

@{

    Property theProperty = ViewBag.FullPropertyResultProperty;
    List<PropertyTypeServicesChargeInstance> towelsCleaningetc = PropertyTypeServicesChargeInstance.GetPropertyTypeServicesChargeInstances(theProperty);
   

    Session["theCurrentProperty"] = theProperty;

    theProperty.CreatePriceRange();

    var regionEntity = PropertyRegion.GetPropertyRegionByProperty(theProperty);
    var region = regionEntity.RegionName;

    List<PropertyPricingSeasonalInstance> thePropertyPriceRange = PropertyPricingSeasonalInstance.GetPricingByPropertyID(theProperty.PropertyID).OrderBy(x => x.PropertyPricingSeason.SeasonOrdinalInYear).ToList();

    if (thePropertyPriceRange.Count == 0)
    {
        thePropertyPriceRange = new List<PropertyPricingSeasonalInstance>();

    }

    PRCImageCollection ImageCollection = ViewBag.ImageCollection;

    BookingCalendar BookingCalDates = ViewBag.BookingCalDates;

    List<DateTime?> lastBookingDays = Booking.GetLastDayOfAllFutureConfirmedBookings(theProperty.PropertyID);

    string bookButtonMessage = "Add to Cart";
    TextInfo myTI = new CultureInfo("en-US", false).TextInfo;

    int thisPropertysNumberOfComments = Comment.GetComments(theProperty).Count;

    int propertyOverallRating = 3;

    if (thisPropertysNumberOfComments > 0)
    {
        propertyOverallRating = (Comment.GetPropertyStarRating(theProperty));
    }
    else
    {
        propertyOverallRating = 2;
    }


    //damage depost - check how many rooms and price accordingly

    var damageDeposit = 0;
    var cleaningAndLaundry = 0;
    var midVacationCleaning = 0;

    var count = 0;
}


@*Script for booking dates*@


@section DocumentReady {
    <script type="text/javascript">

        $(function () {
            //var disabledDays = ["11-21-2012", "11-24-2012", "9-27-2011", "9-28-2011", "9-3-2011", "9-17-2011", "9-2-2011", "9-3-2011", "9-4-2011", "9-5-2011"];


            var highlightDaysGrey = [];
            var disabledDays = [];
            var highlightDays = [];
            var d = new Date();
            var day = d.getDate() - 1;


            @if (BookingCalDates != null)
        {
            if (BookingCalDates.bookingDates.Count > 0)
            {
                foreach (var abookingDate in BookingCalDates.bookingDates)
                {

                    string thePushString = "disabledDays.push('" + abookingDate.bookingDate.ToString("M-d-yyyy") + "');";
                    @Html.Raw(thePushString)
                }

            foreach (var lastBookingDay in lastBookingDays)
            {
                string thePushString = "highlightDays.push('" + ((DateTime)lastBookingDay).ToString("M-d-yyyy") + "');";
					@Html.Raw(thePushString)
            }

             foreach (var abookingDate in BookingCalDates.bookingDates)
                {

                    string thePushString = "highlightDaysGrey.push('" + abookingDate.bookingDate.ToString("M-d-yyyy") + "');";
                    @Html.Raw(thePushString)
                }

            }
        }

            function disableAllTheseDays(date) {



                var m = date.getMonth(), d = date.getDate(), y = date.getFullYear();

                if (highlightDays.length > 0) {
                    for (i = 0; i < highlightDays.length; i++) {
                        if ($.inArray((m + 1) + '-' + d + '-' + y, highlightDays) != -1) {
                            //return [false];

                       
                            return [true, 'Highlight', ''];
                        }
                    }
                }

                if (disabledDays.length > 0) {
                    for (i = 0; i < disabledDays.length; i++) {
                        if ($.inArray((m + 1) + '-' + d + '-' + y, disabledDays) != -1) {
                            return [false];
                        }
                    }
                }



                if (highlightDaysGrey.length > 0) {
                    for (i = 0; i < highlightDaysGrey.length; i++) {
                        if ($.inArray((m + 1) + '-' + d + '-' + y, highlightDaysGrey) != -1) {
                            //return [false];

                            return [true, 'HighlightGrey', ''];
                        }
                    }
                }

                return [true];
            }

            $("#BookingDateCalendar").datepicker(
                {
                    //add JSON
                    dateFormat: 'dd-mm-yy',
                    beforeShowDay: disableAllTheseDays,
                    changeMonth: true,
                    changeYear: true,
                    numberOfMonths: [3, 4],
                    minDate: -day,
                    maxDate: "+4Y",
                    showButtonPanel: true
                });



            $("#EndBookingDate1").datepicker(
                {
                    //add JSON
                    dateFormat: 'dd-mm-yy',
                    beforeShowDay: disableAllTheseDays,
                    changeMonth: true,
                    changeYear: true
                });



        });


        @*$(function() {
			$("#map1").gMap({
				controls: false,
				markers: [{
					latitude: "@theProperty.GPSCoordinatesLatitude",
					longitude:"@theProperty.GPSCoordinatesLongitude",
					popup: true,
					icon: {image: "Images/map_pin1.png",
						iconsize: [26, 46],
						iconanchor: [12,46],
						infowindowanchor: [12, 0]
					},
				}],
				icon: {
					image: "images/map_pin1.png",
					iconsize: [26, 46],
					iconanchor: [12, 46]
				},
				zoom: 14
			});
		});*@


    var home = new google.maps.LatLng("@theProperty.GPSCoordinatesLatitude", "@theProperty.GPSCoordinatesLongitude");

    function initialize() {
        var mapOptions = {
            center: new google.maps.LatLng("@theProperty.GPSCoordinatesLatitude", "@theProperty.GPSCoordinatesLongitude"),
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map-property"),
            mapOptions);

        var marker = new google.maps.Marker({
            map: map,
            draggable: false,
            animation: false,
            position: home
        });

    }

    google.maps.event.addDomListener(window, 'load', initialize);







    </script>

    <script type="text/javascript">
		@*  for (i = 0; i < 7; i++) {

			$(".section" + i).click(function () {
				$(".sidebaractive").removeClass("sidebaractive");
				$(this).parent("li").addClass("sidebaractive");
			});
		}

		$(".totop").click(function () {
			$(".sidebaractive").removeClass("sidebaractive");
			$(".section1").parent("li").addClass("sidebaractive");
		});

		$(document).ready(function () {
			var section1Height = $("#section1").height();
			var section1offset = 940;

			var section2Height = $("#section2").height();
			var section2offset = $("#section2").position().top + section1offset;

			var section3Height = $("#section3").height();
			var section3offset = $("#section3").position().top + section1offset;

			var section4Height = $("#section4").height();
			var section4offset = $("#section4").position().top + section1offset;

			var section5Height = $("#section5").height();
			var section5offset = $("#section5").position().top + section1offset;

			var section6Height = $("#section6").height();
			var section6offset = $("#section6").position().top + section1offset;

			var section7Height = $("#section7").height();
			var section7offset = $("#section7").position().top + section1offset;

			$(window).scroll(function () {
				var winTop = $(window).scrollTop();
				if (winTop >= section1offset && winTop <= section1offset + section1Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section1").parent("li").addClass("sidebaractive");
				} else if (winTop >= section2offset && winTop <= section2offset + section2Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section2").parent("li").addClass("sidebaractive");
				} else if (winTop >= section3offset && winTop <= section3offset + section3Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section3").parent("li").addClass("sidebaractive");
				} else if (winTop >= section4offset && winTop <= section4offset + section4Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section4").parent("li").addClass("sidebaractive");
				} else if (winTop >= section5offset && winTop <= section5offset + section5Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section5").parent("li").addClass("sidebaractive");
				} else if (winTop >= section6offset && winTop <= section6offset + section6Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section6").parent("li").addClass("sidebaractive");
				} else if (winTop >= section7offset && winTop <= section7offset + section6Height) {
					$(".sidebaractive").removeClass("sidebaractive");
					$(".section7").parent("li").addClass("sidebaractive");
				}
			});
		});

	</script>*@

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

}

@*searchbar*@

<!---------------------------------------------------------
              CONTENT CONTAINER FOR RESULTS
---------------------------------------------------------->

<div class="row-fluid">
    <div class="span7 offset1">
        <ul class="breadcrumb">
            <li><a href="~/Home">Home</a><span class="divider">/</span></li>
            <li><a href="~/SearchProperties">Properties</a><span class="divider">/</span></li>
            <li class="active"><a href="@theProperty.LegacyReference">@theProperty.LegacyReference</a></li>
        </ul>
    </div>
    <!-- sub navigation with social media etc. -->
    <div class="span3">
        <a href="#" onclick="history.go(-1);return false;">
            <div class="pull-right"><i class="fa fa-fw fa-undo"></i>Back to Last Page</div>
        </a>
    </div>
</div>

<div class="row-fluid">
    <div class="span7 offset1 Wrapper">
        <!--------------LEFT HAND COLUMN ---------------->
        <div class="span12" id="section1">
            <!-- Property Full Details -->
            <div class="grid">
                @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                <div class="pull-right grid-dropdown">
                    <div class=" icon-title">
                        <div class="dropdown">
                            <a class="dropdown-toggle" id="dlabel1" role="button" data-toggle="dropdown" data-target="#">
                                <i class="fa fa-bars"></i>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel1">
                                <li>
                                    <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                </li>
                                <li>
                                    <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="grid-title">
                    <div class="pull-left">
                        <div class="icon-title"><i class="fa fa-fw fa-eye"></i></div>
                        <span>Overview</span>
                    </div>
                </div>

                <div class="grid-content">
                    <div class="span12">
                        <!-- Property Title -->
                        <div class="row-fluid">
                            <div class="span12">
                                <h3 style="margin: 0; float: left;">@theProperty.PropertyName -</h3>
                                <div class="ratings span3">
                                    <span class="pull-right"><a href="#reviewsDiv">@thisPropertysNumberOfComments Reviews</a></span>
                                    <p style="color: #e74c3c !important;">
                                        <input type="number" name="your_awesome_parameter" value="@propertyOverallRating" class="rating" readonly data-max="4" />
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span12">
                                <p style="font-size: 11pt; margin: 0;"><i class="fa fa-fw fa-map-marker"></i>@theProperty.PropertyTown.TownName</p>
                            </div>
                        </div>
                    </div>
                    <!-- Slider -->
                    <div class="row-fluid">
                        <div class="span12">
                            <!-- Top part of the slider -->
                            <div class="row-fluid">
                                <div class="span8">
                                    @* Carousel *@
                                    <div id="FullPropertyCarousel" class="owl-carousel owl-theme">
                                        @* Begin repeated slides *@
                                        @if (ImageCollection.PropertyImagesExists)
                                        {
                                            int i = 0;
                                            string item_ActiveItem = "active item";

                                            foreach (var image in ImageCollection.PropertyImageList)
                                            {
                                                <div class="item thumbnail imgLiquidFill imgLiquid">
                                                    <img class="car" src="~/PropertyImages/@ImageCollection.PRCRef/@image.ImageDirectory/@image.ImageName" />
                                                    <div class="caption">
                                                        @{
                                                char[] ImageDescTemp = image.ImageDescription.ToString().Replace("_", " ").ToCharArray();
                                                ImageDescTemp[0] = ImageDescTemp[0].ToString().ToUpper()[0];
                                                string s = new string(ImageDescTemp);
                                                @s;
                                                        }
                                                    </div>
                                                </div>
                                                  i++;
                                            }
                                        }
                                    </div>
                                </div>

                                <div class="span4">
                                    <table class="table table-striped table-bordered">
                                        <tbody>
                                            <tr>
                                                <td class="toTranslate">Per Wk From:</td>
                                                <td>
                                                    <strong class="label label-info">
                                                        @Html.Currency()@Html.CurrencySymbol()@{if (thePropertyPriceRange.Count > 0)
                                                        {
                                                            @Html.CurrencyConvert(Math.Round(theProperty.PriceRange.MinPrice.GetValueOrDefault(), 2, MidpointRounding.ToEven), DependencyResolver.Current.GetService<ICurrencyConvert>())
                                                                     

                                                            }}
                                                    </strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Property Ref:</td>
                                                <td><strong>@theProperty.LegacyReference</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Property Type:</td>
                                                <td><strong class="toTranslate">@PropertyType.GetPropertyTypeByProperty(theProperty).PropertyTypeName</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Region:</td>
                                                <td><strong class="toTranslate">@region</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Holiday Type:</td>
                                                <td>
                                                    <strong class="toTranslate">
                                                        @if (PropertyVacationType.GetVacationTypeByProperty(theProperty).PropertyVacationTypeDescription != null)
                                                        {
                                                            @PropertyVacationType.GetVacationTypeByProperty(theProperty).PropertyVacationTypeDescription;

                                                        }
                                                    </strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Sleeps:</td>
                                                <td><strong>@theProperty.MaxGuests</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Bedrooms:</td>
                                                <td><strong>@theProperty.Bedrooms</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Bathrooms:</td>
                                                <td><strong>@theProperty.Bathrooms</strong></td>
                                            </tr>
                                            <tr>
                                                <td class="toTranslate">Pool:</td>
                                                <td><strong>@theProperty.SwimmingPoolType</strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/Slider-->

                    <div id="propertyOverview">
                        <strong id="aboutTheProperty" style="margin-top: 40px;"><css-decorator class="toTranslate">Property Description</css-decorator></strong>
                        <div class="description toTranslate" style="white-space: pre-line">
                        
                            @Html.Raw(theProperty.FullDescription)
                            
                        
                        </div>
                        <!-- end description -->
                    </div>
                    <!-- end overview -->
                    <!-- Button to trigger modal -->

                    <div class="row-fluid">
                        <div class="pull-right">
                            <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                        </div>
                    </div>
                </div>
            </div>

            <!----------------------------------- Section 1 ends ------------------------------------------------>
            <!-- Photos section -->
            <div id="section2" class="section" name="section2">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right grid-dropdown">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel2" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel2">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-camera"></i></div>
                            <span>Photos</span>
                        </div>
                    </div>

                    <div class="grid-content overflow">

                        <ul class="thumbnails thumbnail-full">
                            @if (ImageCollection.PropertyImagesExists)
                            {
                                foreach (var image in ImageCollection.PropertyImageList)
                                {
                                    <li class="span4">
                                        <a class="thumbnail fancybox imgLiquidFill imgLiquid" data-fancybox-group="imagegallery" href="~/PropertyImages/@ImageCollection.PRCRef/@image.ImageDirectory/@image.ImageName" title="@image.ImageDescription">
                                            <span>
                                                <img class="carouselPhoto" src="~/PropertyImages/@ImageCollection.PRCRef/@image.ImageDirectory/@image.ImageName" alt="">
                                            </span>

                                            <div class="caption">
                                                @{
                                    char[] ImageDescTemp = image.ImageDescription.ToString().Replace("_", " ").ToCharArray();
                                    ImageDescTemp[0] = ImageDescTemp[0].ToString().ToUpper()[0];
                                    string s = new string(ImageDescTemp);
                                    @s;
                                                }
                                            </div>
                                        </a>
                                        @*     <div class="p_actions">
                                                <a href="~/PropertyImages/@ImageCollection.PRCRef/@image.ImageDirectory/@image.ImageName" class="p_zoom fancybox" data-fancybox-group="gallery"></a>
                                            </div>*@


                                    </li>
                                }
                            }
                        </ul>
                        <!-- Button to trigger modal -->
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!----------------------------------- Section 2 ends ------------------------------------------------>
            <!-- Availability Calendar Section -->

            <div id="section3" class="section" name="section3">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel3" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel3">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-calendar"></i></div>
                            <span><css-decorator class="toTranslate">Availability</css-decorator></span>
                        </div>
                    </div>

                    <div class="grid-content">

                        <div id="jCalTarget"></div>

                        <div class="row-fluid">
                            <div class="keyWrap span12 silver pagination-centered">
                                <div id="bluebox"></div>
                                <p><css-decorator class="toTranslate">Available</css-decorator></p>
                                @*  <div id="orangebox"></div>
                                    <p>Provisional</p>*@
                                <div id="greybox"></div>
                                <p><css-decorator class="toTranslate">Booked</css-decorator></p>

                                <div id="greybox" style="background-color: #d04419"></div>
                                <p><css-decorator class="toTranslate">Changeover Day</css-decorator></p>
                                @*  <div id="orangebox"></div>
                                    <p>Provisional</p>*@

                            </div>
                        </div>

                        <div id="BookingDateCalendar"></div>

                        <!-- Button to trigger modal -->
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!----------------------------------- Section 3 ends ------------------------------------------------>
            <!-- Location Section -->
            <div id="section4" class="section" name="section4">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel4" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel4">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-map-marker"></i></div>
                            <span><css-decorator class="toTranslate">Location</css-decorator></span>
                        </div>
                    </div>

                    <div class="grid-content overflow">
                        <div>
                            <div id="map-property" class="span12" style="height: 320px; border: 1px solid #ddd; position: relative; overflow: hidden; margin-bottom: 20px;"></div>
                        </div>
                        <!-- Button to trigger modal -->
                        <div class="row-fluid">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!----------------------------------- Section 4 ends ------------------------------------------------>
            <!-- Price Rates Section -->

            <div id="section5" class="section" name="section5">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel5" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel5">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-credit-card"></i></div>
                            <span><css-decorator class="toTranslate">Season Rates</css-decorator></span>
                        </div>
                    </div>


                    <div class="grid-content overflow">
                        <div class="pull-right">
                            <small class="toTranslate">Currency:</small>

                            <select id="currencyConverter">
                                <option value="GBP" class="toTranslate">UK Pound £</option>
                                <option value="EUR" class="toTranslate">Euro €</option>
                                <option value="USD" class="toTranslate">U.S. Dollar $</option>
                                <option value="CAD" class="toTranslate">Canadian Dollar $</option>
                                <option value="JPY" class="toTranslate">Japanese Yen ¥ </option>

                            </select>
                        </div>
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th><css-decorator class="toTranslate">Season</css-decorator></th>
                                    <th><css-decorator class="toTranslate">Start Date (Month/Day)</css-decorator></th>
                                    <th><css-decorator class="toTranslate">End Date (Month/Day)</css-decorator></th>
                                    <th><css-decorator class="toTranslate">Prices</css-decorator></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var propPricing in thePropertyPriceRange)
                                {
                                    <tr>
                                        <td><css-decorator class="toTranslate">@propPricing.PropertyPricingSeason.Season_Name</css-decorator></td>
                                        <td class="hidden-mobile">
                                            @if (propPricing.PropertyPricingSeason.SeasonStartDate != null)
                                            {
                                                @(((DateTime)propPricing.PropertyPricingSeason.SeasonStartDate).ToString("dd/MM"));
                                            }
                                        </td>
                                        <td class="hidden-mobile">
                                            @if (propPricing.PropertyPricingSeason.SeasonStartDate != null)
                                            {
                                                @(((DateTime)propPricing.PropertyPricingSeason.SeasonEndDate).ToString("dd/MM"));
                                            }
                                        </td>
                                        <td class="toTranslate">
                                            Per Week

                                            <b class="price">
                                               

                                                <css-decorator id="originalCurrency@{@count}" class="priceTest">
                                                    @Html.Currency()@Html.CurrencySymbol()                                     
                                                    @if (propPricing.Price != null)
                                                    {
                                                        @Html.CurrencyConvert(Math.Round((Decimal)propPricing.Price, 2), DependencyResolver.Current.GetService<ICurrencyConvert>())
                                                        
                                                    }
                                                </css-decorator>
                                            </b>

                                            <b hidden id="convertedCurrency@{@count}"></b>
                                            @{ count++;}



                                        </td>

                                    </tr>

                                }
                            </tbody>
                        </table>
                        <!-- Button to trigger modal -->
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!----------------------------------- Section 5 ends ------------------------------------------------>
            <!-- Extra Rates Section -->

            <div id="section5b" class="section" name="section5b">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel5b" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel5">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-credit-card"></i></div>
                            <span><css-decorator class="toTranslate">Rental Rates</span>
                        </div>
                    </div>

                    <div class="grid-content overflow">
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th><css-decorator class="toTranslate">Refundable Damage Deposit</css-decorator></th>
                                    <th><css-decorator class="toTranslate">Pricing Notes</css-decorator></th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr>

                                    @{
    /*if (@theProperty@.MaxGuests> )*/
    <td>@Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(2) && x.Bedrooms >= theProperty.Bedrooms).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>())</td>
                                        <td>
                                            <css-decorator class="toTranslate">
                                                Rental Rates DO NOT include cleaning and laundry after the visit. This is charged extra @Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(4)).Where(y => y.PropertyTypeID == theProperty.PropertyTypeID).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>())/- which will be added to your bill. If mid-vacation cleaning services are required, this can be arranged at an additional cost of @Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(1)).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>())
                                                /- per visit.
                                                The cost of heating during winter visits or any other cold spells at other times of year, is charged @Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(3) && x.Bedrooms >= theProperty.Bedrooms).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>())/- per day. Swim towels extra @Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(5)).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>()) per towel per week. Please check at the time of booking.
                                            </css-decorator>
                                            <hr />
                                            <ul>
                                                <li class="toTranslate">&bull; 30% Initial deposit payable by bank transfer 4 weeks prior to arrival. Then 70% is payable by bank transfer 4 weeks prior to arrival.</li>
                                                <li class="toTranslate">&bull; A fully refundable breakage deposit of @Html.Currency()@Html.CurrencySymbol()@Html.CurrencyConvert(towelsCleaningetc.Where(x => x.PropertyTypeServicesID.Equals(2) && x.Bedrooms >= theProperty.Bedrooms).FirstOrDefault().ServicePriceGBP, DependencyResolver.Current.GetService<ICurrencyConvert>()) will apply to all bookings. This amount is payable, along with the final rental instalment, 4 weeks prior to arrival.</li>
                                                <li class="toTranslate">&bull; The breakage deposit will be refunded within 10 working days after leaving the villa subject to any damage or breakage that occurs during your stay.</li>
                                                <li class="toTranslate">&bull; If you are visiting from outside the European Union, then the breakage deposit should be paid in cash Euros on arrival. The caretaker will inspect the property and refund your deposit in cash Euros, on departure day, provided there is no damage or breakage at the property.</li>
                                            </ul>
                                        </td>
                                    }
                                </tr>


                            </tbody>
                        </table>
                        <p>
                        <p><strong><css-decorator class="toTranslate">NOTE</css-decorator>: </strong><css-decorator class="toTranslate">Please note the owner of this property accepts payment in the original currency specified (@Html.Currency()), before use of conversion tool. the conversion tool is provided for your convenience only. the owner may accept other currencies if specifically agreed in advance</css-decorator>.</p>
                        <!-- Button to trigger modal -->
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!----------------------------------- Section 5 ends ------------------------------------------------>
            <!-- All features Section -->

            <div id="section6" class="section" name="section6">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel6" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel6">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-list-ul"></i></div>
                            <span class="toTranslate"><css-decorator class="toTranslate">Property Features</css-decorator></span>
                        </div>
                    </div>
                    <div class="grid-content overflow">
                        <table class="table table-bordered table-striped">
                            <tr>
                                <td class="toTranslate">Property Type:</td>
                                <td class="bold">@theProperty.PropertyType.PropertyTypeName</td>
                                <td class="toTranslate">Region:</td>
                                <td class="bold">@region</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Holiday Type:</td>
                                <td class="bold .toTranslate">@theProperty.PropertyVacationType.PropertyVacationTypeDescription</td>
                                <td class="toTranslate">Property Ref:</td>
                                <td class="bold">@theProperty.LegacyReference</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Change Over Day:</td>
                                <td class="bold">@theProperty.ChangeOverDay</td>
                                <td class="toTranslate">Parking:</td>
                                <td class="bold">@theProperty.Parking</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Pets:</td>
                                <td class="bold">@theProperty.Pets</td>
                                <td class="toTranslate">Disabled Access:</td>
                                <td class="bold">@theProperty.DisabledAccess</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Smoking:</td>
                                <td class="bold">@theProperty.Smoking</td>
                                <td class="toTranslate">Swimming Pool:</td>
                                <td class="bold">@theProperty.SwimmingPool</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Heating:</td>
                                <td class="bold">@theProperty.Heating</td>
                                <td class="toTranslate">Air Conditioning:</td>
                                <td class="bold">@theProperty.AirConditioning</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Internet:</td>
                                <td class="bold">@theProperty.InternetAccess</td>
                                <td class="toTranslate">HI-FI:</td>
                                <td class="bold">@theProperty.HiFi</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">TV:</td>
                                <td class="bold">@theProperty.TV</td>
                                <td class="toTranslate">Sofa Beds:</td>
                                <td class="bold">@theProperty.SofaBeds</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Bedrooms:</td>
                                <td class="bold">@theProperty.Bedrooms</td>
                                <td class="toTranslate">Sleeps:</td>
                                <td class="bold">@theProperty.MaxGuests</td>
                            </tr>
                            <tr>
                                <td class="toTranslate">Extra Beds:</td>
                                <td class="bold">@theProperty.ExtraBeds</td>
                                <td class="toTranslate">High Chair:</td>
                                <td class="bold">@theProperty.HighChair</td>
                            </tr>
                        </table>
                        <!-- Button to trigger modal -->
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#myModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>@bookButtonMessage</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!----------------------------------- Section 6 ends ------------------------------------------------>
            <!-- The booking form Section -->

            <div id="section7" class="section" name="section7">
                <div class="grid">
                    @* THIS IS THE SCROLL TO SECTION DROPDOWN *@
                    <div class="pull-right" style="position: absolute; z-index: 5000; right: 10px; top: 10px;">
                        <div class=" icon-title">
                            <div class="dropdown">
                                <a class="dropdown-toggle" id="dlabel7" role="button" data-toggle="dropdown" data-target="#">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel7">
                                    <li>
                                        <a class="scroll" href="#section1"><i class="fa fa-fw fa-eye"></i>Overview</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section2"><i class="fa fa-fw fa-camera"></i>Photos</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section3"><i class="fa fa-fw fa-calendar"></i>Availability</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section4"><i class="fa fa-fw fa-map-marker"></i>Location</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section5"><i class="fa fa-fw fa-credit-card"></i>Season Rates</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section6"><i class="fa fa-fw fa-list-ul"></i>Features</a>
                                    </li>
                                    <li>
                                        <a class="scroll" href="#section7"><i class="fa fa-fw fa-comment"></i>Reviews</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="grid-title">
                        <div class="pull-left">
                            <div class="icon-title"><i class="fa fa-fw fa-comment"></i></div>
                            <span><css-decorator class="toTranslate">Customer Reviews</css-decorator></span>
                        </div>
                    </div>

                    @*
                        <div class="row-fluid" style="margin-top: 20px;">
                            <div class="pull-right">
                                <a data-toggle="modal" href="#commentModal" class="btn btn-success pull-right"><i class="fa fa-fw fa-shopping-cart"></i>Add A Comment</a>
                            </div>
                        </div>*@

                    <div class="grid-content overflow" id="reviewsDiv" name="reviewsDiv">

                        @{Html.BeginForm("Create", "Comment", FormMethod.Post, new { @class = "aFormToValidate" });}
                        <div class="lightGrey">
                            <b>Write Review</b>
                            @* <form action="/Comment/Create" method="POST" >*@
                            <input type="hidden" name="PropertyID" id="PropertyID" value=@theProperty.PropertyID />
                            <input type="hidden" name="Approved" id="Approved" value="false" />
                            <div class="row-fluid">
                                <div class="span6">
                                    <label><css-decorator class="toTranslate">Full Name</css-decorator>:</label>
                                    <input type="text" class="span12 makeValid" name="Username" id="FlightNumberArrival" required />
                                </div>
                                <div class="span6 pull-right">
                                    <label><css-decorator class="toTranslate">Your Rating</css-decorator>:</label>
                                    <input type="number" name="StarRating" class="rating makeValid" data-max="4" required />
                                </div>
                            </div>
                            <div class="row-fluid">
                                @*need to assign the propertyID here for the post*@
                                <div class="span12">
                                    <label><css-decorator class="toTranslate">Review Title</css-decorator></label>
                                    <input type="text" name="reviewtTitle" id="reviewTitle" class="span12 makeValid" maxlength="100" placeholder="A short description of your stay" required />
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span12">
                                    <label><css-decorator class="toTranslate">Start Date Of Your Stay</css-decorator>:</label>
                                    <input type="text" class="date-picker span12 makeValid" name="StartdateOfStay" placeholder="DD/MM/YY" required>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span12">
                                    <label><css-decorator class="toTranslate">Comment</css-decorator>:</label>
                                    <textarea rows="2" class="span12 makeValid" name="Text" id="Text"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-info submit" value="Confirm"><css-decorator class="toTranslate">Confirm</css-decorator></button>
                        </div>

                        @{Html.EndForm();}


                        @{Html.RenderPartial("PropertyCommentsPartialView");}

                        @*   <div class="row-fluid">
                                <div class="span12">
                                    <div class="pagination pagination-centered">
                                        <ul>
                                            <li><a href="#">Prev</a></li>
                                            <li><a href="#">1</a></li>
                                            <li><a href="#">2</a></li>
                                            <li><a href="#">3</a></li>
                                            <li><a href="#">4</a></li>
                                            <li><a href="#">5</a></li>
                                            <li><a href="#">Next</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>*@

                    </div>
                </div>
            </div>
        </div>
        <!-- end property container -->
    </div>
    <!-- end columnleft --->
    <!------------------------------- RIGHT HAND COLUMN --------------------------------------->
    <div class="span3">
        @{  Html.RenderPartial("checkoutPartialView");

        }

        @{ Html.RenderPartial("SideBookingFormPartialView");
        }
    </div>
    <!-- end right column -->
</div>
<!-- end white div -->
